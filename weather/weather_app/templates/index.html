{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Weather</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="{% static 'weather/assets/img/favicon.png' %}" rel="icon" />
    <link
      href="{% static 'weather/assets/img/apple-touch-icon.png' %}"
      rel="apple-touch-icon"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,600,600i,700,700i"
      rel="stylesheet"
    />
    <!-- Font Awesome CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />

    <!-- Vendor CSS Files -->
    <link
      href="{% static 'weather/assets/vendor/bootstrap/css/bootstrap.min.css' %}"
      rel="stylesheet"
    />
    <link
      href="{% static 'weather/assets/vendor/bootstrap-icons/bootstrap-icons.css' %}"
      rel="stylesheet"
    />

    <!-- Template Main CSS File -->
    <link href="{% static 'weather/assets/css/style.css' %}" rel="stylesheet" />
  </head>

  <body>
    <div>
      <!-- Video sources go here -->
      <video id="backgroundVideo" autoplay muted loop>
        <!-- Default video source -->

        <!-- Additional sources for different weather conditions -->
        <source
          id="clearsky"
          src="{% static 'weather/clearsky.mp4' %}"
          type="video/mp4"
        />
        <source
          id="fewclouds"
          src="{% static 'weather/fewclouds.mp4' %}"
          type="video/mp4"
        />
        <source
          id="scatteredclouds"
          src="{% static 'weather/scatteredsclouds.mp4' %}"
          type="video/mp4"
        />
        <source
          id="moderaterain"
          src="{% static 'weather/rain.mp4' %}"
          type="video/mp4"
        />
        <source
          id="snowyVideo"
          src="{% static 'weather/snow.mp4' %}"
          type="video/mp4"
        />
        <!-- Add more sources as needed -->
      </video>
    </div>
    <!-- ======= Header ======= -->
    <header id="header">
      <div class="container">
        <h2>IT's Weather Time</h2>
        {% if city_weather_update %}
        <h1 style="text-transform: capitalize">
          <img
            src="http://openweathermap.org/img/w/{{ city_weather_update.icon }}.png"
            alt=""
          />
          {{ city_weather_update.city }}, {{ city_weather_update.country_code }}
        </h1>
        <h3>{{ city_weather_update.time }}</h3>
        <div class="data">
          <div>
            <p class="temperature">{{ city_weather_update.temperature }}</p>
            <p>Temperature</p>
          </div>
          <div>
            <p>{{ city_weather_update.humidity }}%</p>
            <p>Humidity</p>
          </div>
          <div>
            <p>{{ city_weather_update.wind }}</p>
            <p>km/h Wind</p>
          </div>
          <div>
            <h3>{{ city_weather_update.description }}</h3>
          </div>
        </div>
        {% endif %}
        <div class="subscribe">
          <h4>{% if error_message %} {{ error_message }} {% endif %}</h4>
          <form method="post" action="{% url 'index' %}" class="subscribe-form">
            {% csrf_token %}
            <input
              type="text"
              class="form-control"
              id="city"
              name="city"
              value="{{ city }}"
              placeholder="Enter city"
            />
            <button class="btn btn-secondary" type="submit">
              <i class="fa fa-search"></i>
            </button>
          </form>
        </div>
      </div>
    </header>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var weatherCondition = "{{ city_weather_update.description|lower }}";

        // Map weather conditions to video sources
        var videoSources = {
          "few clouds": "{% static 'weather/fewclouds.mp4' %}",
          "scattered clouds": "{% static 'weather/scatteredsclouds.mp4' %}",
          "moderate rain": "{% static 'weather/rain.mp4' %}",
          snowy: "{% static 'weather/snow.mp4' %}",
          "clear sky": "{% static 'weather/clearsky.mp4' %}", // Add this line
        };

        // Set the video source based on the weather condition
        var backgroundVideo = document.getElementById("backgroundVideo");

        // Convert the weather condition to lowercase and remove leading/trailing whitespaces
        var cleanedWeatherCondition = weatherCondition.toLowerCase().trim();

        // Check if the cleaned weather condition exists in videoSources
        if (videoSources.hasOwnProperty(cleanedWeatherCondition)) {
          backgroundVideo.src = videoSources[cleanedWeatherCondition];
        } else {
          // Log an error to the console if the weather condition is not found
          console.error(
            "Weather condition not found:",
            cleanedWeatherCondition
          );
        }
      });
    </script>

    <!-- Vendor JS Files -->
    <script src="{% static 'weather/assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

    <!-- Template Main JS File -->
    <script src="{% static 'weather/assets/js/main.js' %}"></script>
  </body>
</html>
